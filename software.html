<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salsabilah Amin Empires | Master POS</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --primary: #2c3e50; --gold: #d4af37; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; border-bottom: 5px solid var(--gold); }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; padding: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; }
        .stat-card h2 { margin: 0; color: var(--primary); font-size: 28px; }
        .main-content { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; padding: 0 20px; flex-grow: 1; }
        .panel { background: white; padding: 20px; border-radius: 12px; overflow-y: auto; max-height: 60vh; }
        input, select, button { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { background: var(--primary); color: white; border: none; cursor: pointer; transition: 0.3s; font-weight: bold; }
        button:hover { background: #1a252f; border-bottom: 3px solid var(--gold); }
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        .badge { padding: 5px 10px; border-radius: 5px; font-size: 12px; font-weight: bold; }
        .stock-in { background: #e7f3ff; color: #007bff; }
        .sale { background: #e6fffa; color: #38b2ac; }
        .expense { background: #fff5f5; color: #e53e3e; }
        /* Notification Alert Style */
        #guardianAlert { position:fixed; bottom:20px; right:20px; background:#e53e3e; color:white; padding:15px; border-radius:10px; display:none; z-index:1000; border-left:5px solid var(--gold); }
    </style>
</head>
<body>

<div class="header">
    <h1 style="margin:0;">üëë SALSABILAH AMIN EMPIRES</h1>
    <p style="margin:5px 0 0 0; font-size: 14px; opacity: 0.8;">Industrial Intelligence System | UK Reg: 09814720</p>
</div>

<div id="guardianAlert"><strong>üîî Guardian Alert:</strong> <span id="alertMsg"></span> <button onclick="this.parentElement.style.display='none'" style="width:auto; padding:2px 10px; margin-left:10px;">X</button></div>

<div class="dashboard">
    <div class="stat-card"><h3>‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ü‡¶ï ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ</h3><h2 id="totalStock">0</h2><small>‡¶ü‡¶æ‡¶ï‡¶æ (‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï)</small></div>
    <div class="stat-card"><h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶®‡¶ø‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂</h3><h2 id="dailyCash">0</h2><small>‡¶ü‡¶æ‡¶ï‡¶æ</small></div>
    <div class="stat-card"><h3>‡¶Æ‡ßã‡¶ü ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞</h3><h2 id="totalCust">350+</h2><small>‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡ßü ‡¶°‡¶æ‡¶ü‡¶æ</small></div>
</div>

<div class="main-content">
    <div class="panel">
        <h3>üöÄ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
        <select id="actionType" onchange="toggleInputs()">
            <option value="sale">‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü (Sales)</option>
            <option value="stock">‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (Purchase)</option>
            <option value="expense">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö (Expense)</option>
        </select>
        
        <input type="text" id="mainInput" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ / ‡¶ñ‡¶æ‡¶§‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
        <input type="number" id="amtInput" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ / ‡¶ü‡¶æ‡¶ï‡¶æ">
        <input type="number" id="priceInput" placeholder="‡¶è‡¶ï‡¶ï ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø (‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶¨‡¶æ ‡¶ï‡ßá‡¶®‡¶æ)">
        <button onclick="processEmpireLogic()">‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <div class="panel">
        <h3>üìú ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶≤‡ßá‡¶ú‡¶æ‡¶∞ (Live Data)</h3>
        <table id="empireTable">
            <thead>
                <tr>
                    <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                    <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                    <th>‡¶ü‡¶æ‡¶á‡¶™</th>
                    <th>‡¶ü‡¶æ‡¶ï‡¶æ/‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                </tr>
            </thead>
            <tbody id="empireBody"></tbody>
        </table>
    </div>
</div>

<script>
    let empireData = JSON.parse(localStorage.getItem('empire_db')) || { inventory: {}, ledger: [], stats: { cash: 0, stockValue: 0 } };

    function processEmpireLogic() {
        const type = document.getElementById('actionType').value;
        const item = document.getElementById('mainInput').value;
        const qty = parseFloat(document.getElementById('amtInput').value);
        const price = parseFloat(document.getElementById('priceInput').value) || 0;
        const date = new Date().toLocaleDateString();

        if(!item || !qty) return alert("‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶¶‡¶ø‡¶®!");

        if(type === 'stock') {
            empireData.inventory[item] = { qty: (empireData.inventory[item]?.qty || 0) + qty, cost: price };
            empireData.stats.stockValue += (qty * price);
            addLedger(date, `‡¶∏‡ßç‡¶ü‡¶ï ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø: ${item}`, 'stock-in', `+${qty} ‡¶™‡¶ø‡¶∏`);
        } 
        else if(type === 'sale') {
            if((empireData.inventory[item]?.qty || 0) < qty) return alert("‡¶∏‡ßç‡¶ü‡¶ï ‡¶®‡ßá‡¶á!");
            empireData.inventory[item].qty -= qty;
            empireData.stats.cash += (qty * price);
            addLedger(date, `‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü: ${item}`, 'sale', `+${qty * price} TK`);
            generateInvoice(item, qty, price); // ‡¶Ö‡¶ü‡ßã ‡¶á‡¶®‡¶≠‡ßü‡ßá‡¶∏ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶∂‡¶®
        }
        else if(type === 'expense') {
            empireData.stats.cash -= qty;
            addLedger(date, `‡¶ñ‡¶∞‡¶ö: ${item}`, 'expense', `-${qty} TK`);
        }

        saveAndSync();
    }

    function addLedger(date, desc, cls, amt) {
        empireData.ledger.unshift({date, desc, cls, amt});
    }

    function saveAndSync() {
        localStorage.setItem('empire_db', JSON.stringify(empireData));
        renderSystem();
    }

    function renderSystem() {
        document.getElementById('totalStock').innerText = empireData.stats.stockValue.toLocaleString();
        document.getElementById('dailyCash').innerText = empireData.stats.cash.toLocaleString();
        const body = document.getElementById('empireBody');
        body.innerHTML = empireData.ledger.map(row => `<tr><td>${row.date}</td><td>${row.desc}</td><td><span class="badge ${row.cls}">${row.cls.toUpperCase()}</span></td><td>${row.amt}</td></tr>`).join('');
    }

    function toggleInputs() {
        const type = document.getElementById('actionType').value;
        document.getElementById('priceInput').style.display = (type === 'expense') ? 'none' : 'block';
    }

    // --- PRICE GUARDIAN & INVOICE INTEGRATION ---
    function generateInvoice(item, qty, price) {
        const win = window.open('', '_blank');
        win.document.write(`<html><body style="font-family:monospace; padding:20px; text-align:center;"><h2>SALSABILAH AMIN EMPIRES LTD.</h2><p>UK Reg: 09814720</p><hr><p>Item: ${item}</p><p>Qty: ${qty}</p><p>Total: ${qty*price} TK</p><hr><p>Thank You!</p><script>window.print();<\/script></body></html>`);
    }

    async function syncPriceGuardian() {
        // ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶ü‡ßá‡¶° ‡¶ó‡¶æ‡¶∞‡ßç‡¶°‡¶ø‡ßü‡¶æ‡¶® ‡¶ö‡ßá‡¶ï (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶π‡¶¨‡ßá)
        const marketRate = 45000; // ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£
        document.getElementById('guardianAlert').style.display = 'block';
        document.getElementById('alertMsg').innerText = "‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶∏ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§";
    }

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').then(() => console.log("Empire Online"));
    }

    renderSystem();
    setTimeout(syncPriceGuardian, 3000);
</script>
</body>
</html>
